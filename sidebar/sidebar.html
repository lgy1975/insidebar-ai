<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>insidebar.ai</title>

  <!-- Content Security Policy: Restrict iframe sources to trusted AI providers only -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline';
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
    img-src 'self' data: https:;
    frame-src
      https://chatgpt.com
      https://claude.ai
      https://gemini.google.com
      https://google.com
      https://www.google.com
      https://grok.com
      https://x.com
      https://chat.deepseek.com
      https://www.perplexity.ai;
  ">

  <link rel="stylesheet" href="sidebar.css">

  <!-- Material Symbols font -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=block" rel="stylesheet">

  <!-- DNS prefetch and preconnect for faster loading -->
  <link rel="dns-prefetch" href="https://chatgpt.com">
  <link rel="dns-prefetch" href="https://claude.ai">
  <link rel="dns-prefetch" href="https://gemini.google.com">
  <link rel="dns-prefetch" href="https://grok.com">
  <link rel="dns-prefetch" href="https://chat.deepseek.com">

  <link rel="preconnect" href="https://chatgpt.com">
  <link rel="preconnect" href="https://claude.ai">
  <link rel="preconnect" href="https://gemini.google.com">
  <link rel="preconnect" href="https://grok.com">
  <link rel="preconnect" href="https://chat.deepseek.com">
</head>
<body data-theme="auto">
  <div id="app">
    <!-- Provider iframe container -->
    <div id="provider-container">
      <div id="loading" style="display: none;">Loading AI provider...</div>
      <div id="error" style="display: none;"></div>
      <!-- Iframes will be dynamically inserted here -->
    </div>

    <!-- Chat History UI -->
    <div id="chat-history" style="display: none;">
      <div id="history-header">
        <h2 data-i18n="sidebarChatHistory">Chat History</h2>
      </div>

      <div id="history-filters">
        <div class="filter-row-top">
          <input type="text" id="history-search" data-i18n-placeholder="placeholderSearchConversations" placeholder="Search conversations..." list="search-history-list" autocomplete="off" />
          <datalist id="search-history-list">
            <!-- Search history will be dynamically populated here -->
          </datalist>
        </div>
        <div class="search-info">
          <div id="search-result-count" class="search-result-count" style="display: none;"></div>
          <div id="search-helper" class="search-helper" style="display: none;">
            <span class="helper-text">
              <strong>Tips:</strong>
              <code>title:keyword</code> search in titles,
              <code>tag:keyword</code> search in tags,
              <code>provider:name</code> filter by provider,
              <code>"exact phrase"</code> exact match,
              <code>-keyword</code> exclude,
              <code>OR</code> for either term
            </span>
            <button id="close-search-helper" class="helper-close" title="Hide tips">&times;</button>
          </div>
        </div>
        <div class="filter-row-bottom">
          <div id="provider-filter-wrapper">
            <button id="provider-filter-btn" data-i18n-title="tooltipFilterProvider" title="Filter by provider"><span class="material-symbols-outlined">filter_alt</span></button>
            <div id="provider-popup" class="provider-popup" style="display: none;">
              <div class="provider-popup-item" data-value="" data-i18n="labelAllProviders">All Providers</div>
              <!-- Providers will be dynamically populated here -->
            </div>
          </div>
          <button id="history-show-search-tips" data-i18n-title="tooltipShowSearchTips" title="Show search tips"><span class="material-symbols-outlined">help</span></button>
          <button id="history-show-favorites" data-i18n-title="tooltipShowFavorites" title="Show favorites only"><span class="material-symbols-outlined">star</span></button>
        </div>
      </div>

      <div id="conversation-list">
        <!-- Conversation items will be dynamically rendered here -->
      </div>

      <!-- Save Conversation Modal -->
      <div id="save-conversation-modal" class="modal" style="display: none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3 data-i18n="btnSave">Save Conversation</h3>
            <button class="close-btn" data-i18n-title="btnClose" id="close-save-conversation"><span class="material-symbols-outlined">close</span></button>
          </div>
          <div class="modal-body">
            <input type="text" id="conversation-title-input" placeholder="Conversation title (auto-generated from content)" />
            <textarea id="conversation-content-input" placeholder="Paste conversation content here..."></textarea>
            <input type="text" id="conversation-provider-input" placeholder="Provider (e.g., ChatGPT, Claude)" readonly />
            <input type="text" id="conversation-tags-input" placeholder="Tags (comma-separated)" />
            <textarea id="conversation-notes-input" placeholder="Notes (optional)"></textarea>
            <label>
              <input type="checkbox" id="conversation-favorite-input" />
              Mark as favorite
            </label>
          </div>
          <div class="modal-footer">
            <button id="cancel-save-conversation-btn" class="secondary" data-i18n-title="btnCancel" title="Cancel"><span class="material-symbols-outlined">close</span></button>
            <button id="save-conversation-submit-btn" class="primary" data-i18n-title="btnSave" title="Save"><span class="material-symbols-outlined">check</span></button>
          </div>
        </div>
      </div>

      <!-- View Conversation Modal -->
      <div id="view-conversation-modal" class="modal" style="display: none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="view-conversation-title">Conversation</h3>
            <div class="modal-header-actions">
              <button id="copy-conversation-btn" class="header-action-btn" data-i18n-title="tooltipCopyContent" title="Copy content"><span class="material-symbols-outlined" style="font-size: 20px;">content_copy</span></button>
              <button id="delete-conversation-from-view-btn" class="header-action-btn" data-i18n-title="btnDelete" title="Delete"><span class="material-symbols-outlined" style="font-size: 20px;">delete</span></button>
              <button class="close-btn" data-i18n-title="btnClose" id="close-view-conversation"><span class="material-symbols-outlined">close</span></button>
            </div>
          </div>
          <div class="modal-body">
            <div id="view-conversation-content"></div>
            <div id="view-conversation-meta">
              <div id="view-conversation-provider"></div>
              <div id="view-conversation-timestamp"></div>
              <div id="view-conversation-tags"></div>
              <div id="view-conversation-notes"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- T045: Prompt Genie UI -->
    <div id="prompt-library" style="display: none;">
      <!-- Workspace for editing received text - Always visible at top -->
      <div id="workspace-header">
        <h2 data-i18n="sidebarEditingPrompt">Editing Prompt</h2>
      </div>

      <div id="prompt-workspace" style="display: block;">
        <textarea id="prompt-workspace-text" placeholder="Selected text will appear here..."></textarea>
        <div class="workspace-actions">
          <div class="workspace-actions-left">
            <button id="workspace-save-btn" data-i18n-title="tooltipSaveNew" title="Save as new prompt"><span class="material-symbols-outlined">add_2</span></button>
            <button id="workspace-copy-btn" data-i18n-title="tooltipCopyClipboard" title="Copy to clipboard"><span class="material-symbols-outlined">content_copy</span></button>
            <button id="workspace-clear-btn" data-i18n-title="tooltipClear" title="Clear"><span class="material-symbols-outlined">close</span></button>
          </div>
          <div class="workspace-actions-right">
            <div id="workspace-provider-wrapper">
              <button id="workspace-provider-btn" data-i18n-title="tooltipSelectProvider" title="Select provider">
                <img class="provider-icon-small" src="" alt="">
              </button>
              <div id="workspace-provider-popup" class="workspace-provider-popup" style="display: none;">
                <!-- Providers will be dynamically populated here -->
              </div>
            </div>
            <button id="workspace-send-btn" data-i18n-title="tooltipSendProvider" title="Send to selected provider"><span class="material-symbols-outlined">keyboard_return</span></button>
          </div>
        </div>
      </div>

      <div id="prompt-library-header">
        <h2 data-i18n="sidebarPromptGenie">Prompt Genie</h2>
      </div>

      <div id="prompt-filters">
        <div class="filter-row-top">
          <input type="text" id="prompt-search" data-i18n-placeholder="placeholderSearchPrompts" placeholder="Search prompts..." />
        </div>
        <div class="filter-row-bottom">
          <div id="category-filter-wrapper">
            <button id="category-filter-btn" data-i18n-title="tooltipFilterCategory" title="Filter by category"><span class="material-symbols-outlined">category</span></button>
            <div id="category-popup" class="category-popup" style="display: none;">
              <div class="category-popup-item" data-value="" data-i18n="labelAllCategories">All Categories</div>
              <!-- Categories will be dynamically populated here -->
            </div>
          </div>
          <div id="sort-buttons">
            <button class="sort-btn active" data-sort="recent" data-i18n-title="tooltipRecentlyUsed" title="Recently Used"><span class="material-symbols-outlined">schedule</span></button>
            <button class="sort-btn" data-sort="most-used" data-i18n-title="tooltipMostUsed" title="Most Used"><span class="material-symbols-outlined">numbers</span></button>
            <button class="sort-btn sort-toggle" data-sort="alphabetical" data-alt-sort="reverse-alphabetical" data-i18n-title="tooltipAlphabetical" title="A-Z"><span class="material-symbols-outlined">sort_by_alpha</span></button>
            <button class="sort-btn sort-toggle" data-sort="newest" data-alt-sort="oldest" data-i18n-title="tooltipNewestFirst" title="Newest First"><span class="material-symbols-outlined">new_releases</span></button>
          </div>
          <button id="show-favorites" data-i18n-title="tooltipShowFavorites" title="Show favorites only"><span class="material-symbols-outlined">star</span></button>
        </div>
      </div>

      <!-- T071: Quick Access Panel -->
      <div id="quick-access-panel" style="display: none;">
        <div class="quick-access-section">
          <div class="quick-access-header">
            <span class="quick-access-title" data-i18n="labelRecentlyUsed">Recently Used</span>
            <button class="quick-access-toggle" id="toggle-recent" data-i18n-title="tooltipToggleSection" title="Toggle section"><span class="material-symbols-outlined">remove</span></button>
          </div>
          <div class="quick-access-items" id="recent-prompts-list">
            <!-- Recently used prompts will be rendered here -->
          </div>
        </div>

        <div class="quick-access-section">
          <div class="quick-access-header">
            <span class="quick-access-title" data-i18n="labelTopFavorites">Top Favorites</span>
            <button class="quick-access-toggle" id="toggle-favorites" data-i18n-title="tooltipToggleSection" title="Toggle section"><span class="material-symbols-outlined">remove</span></button>
          </div>
          <div class="quick-access-items" id="top-favorites-list">
            <!-- Top favorites will be rendered here -->
          </div>
        </div>
      </div>

      <div id="prompt-list">
        <!-- Prompt items will be dynamically rendered here -->
      </div>

      <!-- T046: Prompt Editor Modal -->
      <div id="prompt-editor-modal" class="modal" style="display: none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="editor-title">New Prompt</h3>
            <button class="close-btn" data-i18n-title="btnClose" id="close-editor"><span class="material-symbols-outlined">close</span></button>
          </div>
          <div class="modal-body">
            <input type="text" id="prompt-title-input" placeholder="Prompt title" />
            <textarea id="prompt-content-input" placeholder="Enter your prompt here..."></textarea>
            <input type="text" id="prompt-category-input" placeholder="Category (e.g., Writing, Coding)" />
            <input type="text" id="prompt-tags-input" placeholder="Tags (comma-separated)" />
            <label>
              <input type="checkbox" id="prompt-favorite-input" />
              Mark as favorite
            </label>
          </div>
          <div class="modal-footer">
            <button id="cancel-edit-btn" class="secondary" data-i18n-title="btnCancel" title="Cancel"><span class="material-symbols-outlined">close</span></button>
            <button id="save-prompt-btn" class="primary" data-i18n-title="btnSave" title="Save"><span class="material-symbols-outlined">check</span></button>
          </div>
        </div>
      </div>

      <!-- T071: Insert Prompt Modal -->
      <div id="insert-prompt-modal" class="modal" style="display: none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Insert text to Prompt Workspace Area</h3>
            <button class="close-btn" data-i18n-title="btnClose" id="close-insert-modal"><span class="material-symbols-outlined">close</span></button>
          </div>
          <div class="modal-body">
            <div class="insert-prompt-preview" id="insert-prompt-preview">
              <!-- Prompt preview will be shown here -->
            </div>
            <p class="modal-description">Choose how to insert this prompt: at the beginning, at the end, or replace the existing text entirely?</p>
          </div>
          <div class="modal-footer">
            <button id="insert-beginning-btn" class="primary" data-i18n-title="tooltipInsertBeginning" title="Insert at beginning"><span class="material-symbols-outlined">vertical_align_top</span></button>
            <button id="insert-end-btn" class="primary" data-i18n-title="tooltipInsertEnd" title="Insert at end"><span class="material-symbols-outlined">vertical_align_bottom</span></button>
            <button id="replace-workspace-btn" class="secondary" data-i18n-title="tooltipReplaceAll" title="Replace all"><span class="material-symbols-outlined">sync</span></button>
          </div>
        </div>
      </div>
    </div>

    <!-- Provider tabs (bottom navigation) -->
    <nav id="provider-tabs">
      <!-- Provider tabs will be dynamically generated here -->
    </nav>
  </div>

  <script src="marked.min.js"></script>
  <script type="module" src="sidebar.js"></script>
</body>
</html>
